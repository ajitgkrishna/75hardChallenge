<div class="week-card">
    <!-- Grid Container for the whole card content to ensure alignment -->
    <div class="week-grid">
        <!-- Header Row -->
        <div class="grid-header-row">
            <div class="week-title">
                Week #{{ week.weekNumber }}
            </div>
            <div class="day-number" *ngFor="let day of week.days">{{ day.day }}</div>
        </div>

        <!-- Task Rows -->
        <div class="grid-row" *ngFor="let task of tasks; let last = last" [class.last-row]="last">
            <div class="task-label">{{ task.label }}</div>

            <div class="checkbox-cell" *ngFor="let day of week.days">
                <div class="custom-checkbox-container" [class.checked]="getDayStatus(day, task.key)"
                    [class.disabled]="day.day > currentDay" [class.saving]="isSaving(day.day, task.key)"
                    (click)="handleTaskClick(day.day, task.key, $event)">

                    <!-- Hidden native checkbox for accessibility/logic -->
                    <input type="checkbox" style="display:none;" [checked]="getDayStatus(day, task.key)"
                        [disabled]="day.day > currentDay || isSaving(day.day, task.key)">

                    <!-- Visual X mark - Only show if NOT saving -->
                    <span class="x-mark" *ngIf="!isSaving(day.day, task.key) && getDayStatus(day, task.key)">âœ•</span>

                    <!-- Spinner -->
                    <div class="spinner" *ngIf="isSaving(day.day, task.key)"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden File Input -->
    <input type="file" #fileInput style="display: none" accept="image/*" (change)="onFileSelected($event)">
</div>